<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>无星的小窝</title>
    <link>http://blog.xingxiaowu.cn/</link>
    
    <atom:link href="http://blog.xingxiaowu.cn/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>一个么的前途的弟中弟</description>
    <pubDate>Mon, 03 Oct 2022 03:14:11 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>无星的饥荒（二）——Mod</title>
      <link>http://blog.xingxiaowu.cn/2022/10/03/%E6%97%A0%E6%98%9F%E7%9A%84%E9%A5%A5%E8%8D%92%EF%BC%88%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94Mod/</link>
      <guid>http://blog.xingxiaowu.cn/2022/10/03/%E6%97%A0%E6%98%9F%E7%9A%84%E9%A5%A5%E8%8D%92%EF%BC%88%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94Mod/</guid>
      <pubDate>Mon, 03 Oct 2022 08:52:04 GMT</pubDate>
      
      <description>&lt;p&gt;我们来讲讲,已经启动的服务器,怎么配置mod&lt;/p&gt;
&lt;h1 id=&quot;一-暂停饥荒服务&quot;&gt;&lt;a href=&quot;#一-暂停饥荒服务&quot; class=&quot;headerlink&quot; title=&quot;一.暂停饥荒服务&quot;&gt;&lt;/a&gt;一.暂停饥荒服务&lt;/h1&gt;&lt;p&gt;通过&lt;code&gt;netstat&lt;/code&gt;和&lt;code&gt;kill&lt;/code&gt;把服务器暂停先.&lt;/p&gt;
&lt;h1 id=&quot;二-解析各个文件夹&quot;&gt;&lt;a href=&quot;#二-解析各个文件夹&quot; class=&quot;headerlink&quot; title=&quot;二.解析各个文件夹&quot;&gt;&lt;/a&gt;二.解析各个文件夹&lt;/h1&gt;&lt;h2 id=&quot;1-dstsave&quot;&gt;&lt;a href=&quot;#1-dstsave&quot; class=&quot;headerlink&quot; title=&quot;1.dstsave&quot;&gt;&lt;/a&gt;1.&lt;code&gt;dstsave&lt;/code&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cd /home/dstsave/dst/World1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ls&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;里面包含两个两个文件夹&lt;code&gt;Master``Caves&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;前面说过,&lt;code&gt;Master&lt;/code&gt;为主世界,&lt;code&gt;Caves&lt;/code&gt;为洞穴&lt;/p&gt;
&lt;p&gt;实际上两个文件夹里的内容都差不多,我们这里只说&lt;code&gt;mod&lt;/code&gt;相关配置&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# 修改的话,最好Master和Caves两者同步修改,这里以Master为例&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd Master&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vim ./modoverrides.lua&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>我们来讲讲,已经启动的服务器,怎么配置mod</p><h1 id="一-暂停饥荒服务"><a href="#一-暂停饥荒服务" class="headerlink" title="一.暂停饥荒服务"></a>一.暂停饥荒服务</h1><p>通过<code>netstat</code>和<code>kill</code>把服务器暂停先.</p><h1 id="二-解析各个文件夹"><a href="#二-解析各个文件夹" class="headerlink" title="二.解析各个文件夹"></a>二.解析各个文件夹</h1><h2 id="1-dstsave"><a href="#1-dstsave" class="headerlink" title="1.dstsave"></a>1.<code>dstsave</code></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /home/dstsave/dst/World1</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><p>里面包含两个两个文件夹<code>Master``Caves</code></p><p>前面说过,<code>Master</code>为主世界,<code>Caves</code>为洞穴</p><p>实际上两个文件夹里的内容都差不多,我们这里只说<code>mod</code>相关配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 修改的话,最好Master和Caves两者同步修改,这里以Master为例</span><br><span class="line">cd Master</span><br><span class="line">vim ./modoverrides.lua</span><br></pre></td></tr></table></figure><p><code>modoverrides.lua</code>实际上就是所有的<code>mod</code>配置信息。</p><p>要开关<code>mod</code>或者修改<code>mod</code>的<code>options</code>就在这个文件里修改。</p><p>开关见<code>enable</code></p><h3 id="问题：里面都是worker-数字，我怎么知道哪个数字是哪个mod"><a href="#问题：里面都是worker-数字，我怎么知道哪个数字是哪个mod" class="headerlink" title="问题：里面都是worker-数字，我怎么知道哪个数字是哪个mod"></a>问题：里面都是<code>worker-数字</code>，我怎么知道哪个数字是哪个mod</h3><p>如果你的所有的<code>mod</code>都是从<code>steam</code>创意工坊下载的，我们可以通过分享按钮查看id</p><p>例如：</p><p><img src="/images/%E9%A5%A5%E8%8D%922/1.png" alt="1.png"></p><p><img src="/images/%E9%A5%A5%E8%8D%922/2.png" alt="2.png"></p><p>那么我们就得到所有mod和id之间的对应关系。</p><h2 id="2-dstserver"><a href="#2-dstserver" class="headerlink" title="2.dstserver"></a>2.<code>dstserver</code></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /home/dstserver</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><p>其中包含一个<code>mods</code>文件夹，其中所有的<code>mod</code>都会下载在里面</p><p><code>mods</code>中存在一个名为<code>dedicated_server_mods_setup.lua</code>的文件</p><p>如果我们需要<code>新增</code>某个mod，则需要在其中新增</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServerModSetup(<span class="string">&quot;id&quot;</span>)</span><br></pre></td></tr></table></figure><p>例如：<code>ServerModSetup(&quot;362175979&quot;)</code></p><h1 id="三-修改mod"><a href="#三-修改mod" class="headerlink" title="三.修改mod"></a>三.修改mod</h1><p>经过第二步，应该就大致了解了。<br>先改<code>/home/dstsave/dst/World1/Master/modoverrides.lua</code><br>和<code>/home/dstsave/dst/World1/Caves/modoverrides.lua</code></p><p>如果是新增<code>Mod</code>，则往<code>/home/dstserver/mods/dedicated_server_mods_setup.lua</code>新增<code>ServerModSetup(&quot;id&quot;)</code></p><h1 id="四-神话书说"><a href="#四-神话书说" class="headerlink" title="四.神话书说"></a>四.神话书说</h1><p><code>神话书说</code>是个很有意思的mod，他分为<code>神话书说世界</code>和<code>神话书说人物</code></p><p>这里有个需要注意的地方，在带有<code>神话书说</code>这俩mod的世界<code>第一次</code>启动时</p><p>必须要先关闭<code>神话书说人物</code>，仅开启<code>神话书说世界</code></p><p>在<code>master_start.sh</code>启动成功后，关闭服务</p><p>再开启<code>神话书说人物</code>,再次启动<code>master_start.sh</code>,才能正常使用神话书说的人物</p><p>不然会因为顺序问题，人物加载失败，导致无法生成世界。</p>]]></content:encoded>
      
      
      <category domain="http://blog.xingxiaowu.cn/categories/%E9%A5%A5%E8%8D%92/">饥荒</category>
      
      
      <category domain="http://blog.xingxiaowu.cn/tags/%E9%A5%A5%E8%8D%92/">饥荒</category>
      
      
      <comments>http://blog.xingxiaowu.cn/2022/10/03/%E6%97%A0%E6%98%9F%E7%9A%84%E9%A5%A5%E8%8D%92%EF%BC%88%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94Mod/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>无星的饥荒（一）——安装</title>
      <link>http://blog.xingxiaowu.cn/2022/10/03/%E6%97%A0%E6%98%9F%E7%9A%84%E9%A5%A5%E8%8D%92%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94%E5%AE%89%E8%A3%85/</link>
      <guid>http://blog.xingxiaowu.cn/2022/10/03/%E6%97%A0%E6%98%9F%E7%9A%84%E9%A5%A5%E8%8D%92%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94%E5%AE%89%E8%A3%85/</guid>
      <pubDate>Mon, 03 Oct 2022 07:52:04 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;一个朋友喜欢玩饥荒,但是总是一个人没意思&lt;/p&gt;
&lt;p&gt;联机版又不会搭房间,去淘宝租服务器一个月20起步&lt;/p&gt;
&lt;p&gt;本着友好助人的美好品德&lt;/p&gt;
&lt;p&gt;帮朋友买了台2G4H 4M的服务器,一年才260,房间我负责搭,平时闲置的服务器我随便用&lt;/p&gt;
&lt;p&gt;我可真是个乐于助人的好人&lt;/p&gt;
&lt;p&gt;我们先选Centos7,然后开动&lt;/p&gt;
&lt;h1 id=&quot;服务器安全组开放端口&quot;&gt;&lt;a href=&quot;#服务器安全组开放端口&quot; class=&quot;headerlink&quot; title=&quot;服务器安全组开放端口&quot;&gt;&lt;/a&gt;服务器安全组开放端口&lt;/h1&gt;&lt;p&gt;服务器安全组把&lt;code&gt;20-21&lt;/code&gt;,&lt;code&gt;60000-60100&lt;/code&gt;放开,&lt;code&gt;10998-10999&lt;/code&gt;为饥荒端口,也放开&lt;/p&gt;
&lt;h1 id=&quot;一-搭FTP&quot;&gt;&lt;a href=&quot;#一-搭FTP&quot; class=&quot;headerlink&quot; title=&quot;一.搭FTP&quot;&gt;&lt;/a&gt;一.搭FTP&lt;/h1&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>一个朋友喜欢玩饥荒,但是总是一个人没意思</p><p>联机版又不会搭房间,去淘宝租服务器一个月20起步</p><p>本着友好助人的美好品德</p><p>帮朋友买了台2G4H 4M的服务器,一年才260,房间我负责搭,平时闲置的服务器我随便用</p><p>我可真是个乐于助人的好人</p><p>我们先选Centos7,然后开动</p><h1 id="服务器安全组开放端口"><a href="#服务器安全组开放端口" class="headerlink" title="服务器安全组开放端口"></a>服务器安全组开放端口</h1><p>服务器安全组把<code>20-21</code>,<code>60000-60100</code>放开,<code>10998-10999</code>为饥荒端口,也放开</p><h1 id="一-搭FTP"><a href="#一-搭FTP" class="headerlink" title="一.搭FTP"></a>一.搭FTP</h1><p>为啥要搭FTP,其实主要是为了方便上传和下载文件,<code>scp</code>多少还是有点麻烦了</p><h2 id="1-防火墙开放端口-不必关"><a href="#1-防火墙开放端口-不必关" class="headerlink" title="1.防火墙开放端口,不必关"></a>1.防火墙开放端口,不必关</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># firewall-cmd --permanent --zone=public --add-service=ftp</span></span><br><span class="line"><span class="comment"># 开放常用端口</span></span><br><span class="line">firewall-cmd --zone=public --list-ports</span><br><span class="line"><span class="comment"># 不行就重启一下</span></span><br><span class="line"><span class="comment"># systemctl restart firewalld.service</span></span><br></pre></td></tr></table></figure><h2 id="2-安装vsftpd"><a href="#2-安装vsftpd" class="headerlink" title="2.安装vsftpd"></a>2.安装vsftpd</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install vsftpd* -y</span><br></pre></td></tr></table></figure><h2 id="3-启动vsftpd"><a href="#3-启动vsftpd" class="headerlink" title="3.启动vsftpd"></a>3.启动vsftpd</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm –ql vsftpd | more</span><br><span class="line">systemctl  restart   vsftpd.service</span><br><span class="line">ps   -ef |grep  vsftpd</span><br></pre></td></tr></table></figure><h2 id="4-配置"><a href="#4-配置" class="headerlink" title="4.配置"></a>4.配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/vsftpd/vsftpd.conf </span><br></pre></td></tr></table></figure><p>直接用我下面这个吧</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"># 开启匿名访问</span><br><span class="line">anonymous_enable=NO</span><br><span class="line">#启用本地系统用户访问</span><br><span class="line">local_enable=YES</span><br><span class="line">#本地系统用户写入全县</span><br><span class="line">write_enable=YES</span><br><span class="line">#本地用户创建文件目录默认权限掩码</span><br><span class="line">local_umask=022</span><br><span class="line">#打印目录显示纤细，通常用于用户第一次访问目录时，信息提示</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line"># 启用上传/下载日志记录</span><br><span class="line">xferlog_enable=YES</span><br><span class="line"># ftp使用20端口进行数据传输</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">#chown_uploads=YES</span><br><span class="line">#chown_username=whoever</span><br><span class="line">#xferlog_file=/var/log/xferlog</span><br><span class="line">#日志文件根据xferlog的标准写入</span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">#idle_session_timeout=600</span><br><span class="line">#data_connection_timeout=120</span><br><span class="line">#nopriv_user=ftpsecure</span><br><span class="line">#async_abor_enable=YES</span><br><span class="line">#ascii_upload_enable=YES</span><br><span class="line">#ascii_download_enable=YES</span><br><span class="line">#ftpd_banner=Welcome to blah FTP service.</span><br><span class="line">#deny_email_enable=YES</span><br><span class="line">#banned_email_file=/etc/vsftpd/banned_emails</span><br><span class="line">#ls_recurse_enable=YES</span><br><span class="line">#打开就对了</span><br><span class="line">listen=YES</span><br><span class="line">#关掉就完事</span><br><span class="line"># listen_ipv6=NO</span><br><span class="line">#登录ftp服务器根据/etc/pam.d/vsftpd内容认证</span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line">#Vsftpd.user_list和ftpusers配置文件离的用户禁止访问ftp</span><br><span class="line">userlist_enable=YES</span><br><span class="line">#设置vsftpd于tcp wrapper结合进行主机访问</span><br><span class="line">tcp_wrappers=YES</span><br><span class="line"></span><br><span class="line"># 被动模式</span><br><span class="line">pasv_enable=YES</span><br><span class="line">pasv_min_port=60000</span><br><span class="line">pasv_max_port=60100</span><br><span class="line"># 修改ftp默认目录</span><br><span class="line">local_root=/home</span><br><span class="line">chroot_local_user=YES</span><br><span class="line">anon_root=/home/anon</span><br><span class="line"></span><br><span class="line">local_enable=YES</span><br><span class="line">write_enable=YES</span><br><span class="line">#</span><br></pre></td></tr></table></figure><h2 id="5-启动ftp专用账号"><a href="#5-启动ftp专用账号" class="headerlink" title="5.启动ftp专用账号"></a>5.启动ftp专用账号</h2><p>这里照抄参考资料<a href="https://blog.csdn.net/D1179869625/article/details/122984871">Centos7 搭建FTP服务器</a></p><h3 id="新增账号"><a href="#新增账号" class="headerlink" title="新增账号"></a>新增账号</h3><p>本次计划目的添加一个管理员账号，使用管理员账号上传管理文件，匿名用户可以查看下载，但是没有其他权限。默认账号路径在/home下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd admin</span><br><span class="line"><span class="built_in">echo</span> admin12345|passwd --stdin admin</span><br></pre></td></tr></table></figure><h3 id="新建目录"><a href="#新建目录" class="headerlink" title="新建目录"></a>新建目录</h3><p><img src="/images/%E9%A5%A5%E8%8D%921/1png.png" alt="1.png"></p><h3 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart vsftpsd</span><br></pre></td></tr></table></figure><h3 id="下载FileZilla"><a href="#下载FileZilla" class="headerlink" title="下载FileZilla"></a>下载<code>FileZilla</code></h3><p><a href="https://www.filezilla.cn/">https://www.filezilla.cn/</a></p><h3 id="使用FileZilla"><a href="#使用FileZilla" class="headerlink" title="使用FileZilla"></a>使用<code>FileZilla</code></h3><p>软件使用应该不用说了</p><h1 id="二-安装SteamCMD"><a href="#二-安装SteamCMD" class="headerlink" title="二.安装SteamCMD"></a>二.安装SteamCMD</h1><h2 id="1-安装SteamCMD所需库"><a href="#1-安装SteamCMD所需库" class="headerlink" title="1.安装SteamCMD所需库"></a>1.安装SteamCMD所需库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum update</span><br><span class="line"></span><br><span class="line">sudo yum -y install glibc.i686 libstdc++.i686 libcurl4-gnutls-dev.i686 libcurl.i686 screen</span><br></pre></td></tr></table></figure><h2 id="2-安装SteamCMD"><a href="#2-安装SteamCMD" class="headerlink" title="2.安装SteamCMD"></a>2.安装SteamCMD</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home &amp;&amp; <span class="built_in">mkdir</span> steamcmd &amp;&amp; <span class="built_in">cd</span> steamcmd</span><br><span class="line"></span><br><span class="line">wget https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz</span><br><span class="line"></span><br><span class="line">tar -xvzf steamcmd_linux.tar.gz</span><br><span class="line"></span><br><span class="line">./steamcmd.sh</span><br></pre></td></tr></table></figure><h2 id="3-下载饥荒服务端"><a href="#3-下载饥荒服务端" class="headerlink" title="3.下载饥荒服务端"></a>3.下载饥荒服务端</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先执行设置下载地址</span></span><br><span class="line">force_install_dir /home/dstserver</span><br><span class="line"><span class="comment"># 匿名登陆</span></span><br><span class="line">login anonymous</span><br><span class="line"><span class="comment"># 这里注意,使用的是update,如果存在,则更新,如果不存在,则下载</span></span><br><span class="line">app_update 343050 validate</span><br></pre></td></tr></table></figure><h2 id="4-解决libcurl-gnutls-so-4缺失问题"><a href="#4-解决libcurl-gnutls-so-4缺失问题" class="headerlink" title="4.解决libcurl-gnutls.so.4缺失问题"></a>4.解决<code>libcurl-gnutls.so.4</code>缺失问题</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/lib/libcurl.so.4 /home/dstserver/bin/lib32/libcurl-gnutls.so.4</span><br></pre></td></tr></table></figure><h2 id="5-生成主世界-master-start-sh-和洞穴-cave-start-sh-命令"><a href="#5-生成主世界-master-start-sh-和洞穴-cave-start-sh-命令" class="headerlink" title="5.生成主世界(master_start.sh)和洞穴(cave_start.sh)命令"></a>5.生成主世界(master_start.sh)和洞穴(cave_start.sh)命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/dstserver/bin</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;./dontstarve_dedicated_server_nullrenderer -console -persistent_storage_root /home/dstsave -conf_dir dst -cluster World1 -shard Master&quot;</span> &gt; master_start.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;./dontstarve_dedicated_server_nullrenderer -console -persistent_storage_root /home/dstsave -conf_dir dst -cluster World1 -shard Caves&quot;</span> &gt; cave_start.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x master_start.sh cave_start.sh</span><br></pre></td></tr></table></figure><h2 id="6-启动一次世界生成默认文件"><a href="#6-启动一次世界生成默认文件" class="headerlink" title="6.启动一次世界生成默认文件"></a>6.启动一次世界生成默认文件</h2><p>肯定链接失败,报没有token,这是预期内的,不用担心</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./master_start.sh</span><br></pre></td></tr></table></figure><p>启动完成后<code>Ctrl+C</code>关闭服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./cave_start.sh</span><br></pre></td></tr></table></figure><p>启动完成后<code>Ctrl+C</code>关闭服务</p><p>此时可以看到<code>home</code>目录下生成了两个文件夹<code>dstsave</code>和<code>dstsever</code></p><p><code>dstsave</code>: 数据文件,里面包含世界,存档</p><p><code>dstsever</code>: 服务端文件</p><h2 id="7-在自己电脑上创建饥荒世界"><a href="#7-在自己电脑上创建饥荒世界" class="headerlink" title="7.在自己电脑上创建饥荒世界"></a>7.在自己电脑上创建饥荒世界</h2><p>创建完毕后,回到饥荒首页的左下角,有个游戏数据,点一下会打开本地文件夹,李米娜包含了刚刚创建的世界</p><p><code>Cluster_*</code>文件夹是世界数据,12345表示创建的第几个世界.</p><p>文件夹内包含</p><p><code>Master</code>:主世界配置<br><code>Caves</code>:洞穴配置<br><code>cluster.ini</code>:房间配置</p><p>我们要做的,就是通过<code>ftp</code>,将这些内容,放到服务器的<code>/home/dstsave/dst/World1</code>目录下.</p><h2 id="8-获取token"><a href="#8-获取token" class="headerlink" title="8.获取token"></a>8.获取token</h2><p>回到饥荒客户端首页,左下角有个叫<code>账户信息</code>的按钮,点击跳转<code>Klei</code>,点击<code>我的游戏</code>,再点击右上角<code>Don’t Strave Together Servers</code>,下方有个<code>添加新的服务器</code>,随便填个名字就行了,会得到一个<code>token</code>,复制这个<code>token</code></p><h2 id="9-在服务器上放置token"><a href="#9-在服务器上放置token" class="headerlink" title="9.在服务器上放置token"></a>9.在服务器上放置token</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /home/dstsave/dst/World1</span><br><span class="line">touch cluster_token.txt</span><br><span class="line">vim cluster_token.txt</span><br></pre></td></tr></table></figure><p>把<code>token</code>放进去</p><h1 id="三-启动饥荒"><a href="#三-启动饥荒" class="headerlink" title="三.启动饥荒"></a>三.启动饥荒</h1><h2 id="1-启动"><a href="#1-启动" class="headerlink" title="1.启动"></a>1.启动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/dstserver/bin</span><br></pre></td></tr></table></figure><h2 id="2-screen命令"><a href="#2-screen命令" class="headerlink" title="2.screen命令"></a>2.<code>screen</code>命令</h2><p>通过<code>-R</code>启动一个容器,如果存在,则进入容器,如果不存在,则创建一个容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">screen -R master</span><br><span class="line">./master_start.sh</span><br></pre></td></tr></table></figure><p>如果没报错并且看到<code>Simple pause</code>就代表启动成功，按下<code>Ctrl+A</code>然后再按下<code>Ctrl+D</code>就可以让服务后台运行，并回到原来的控制台</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">screen -R caves</span><br><span class="line"></span><br><span class="line">./cave_start.sh</span><br></pre></td></tr></table></figure><p>洞穴同理</p><p>要看<code>log</code>就继续使用<code>screen -R master</code>或者<code>screen -R caves</code></p><h2 id="3-查看端口"><a href="#3-查看端口" class="headerlink" title="3.查看端口"></a>3.查看端口</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 主世界</span><br><span class="line">netstat -nlp |grep :10999</span><br><span class="line"># 洞穴</span><br><span class="line">netstat -nlp |grep :10998</span><br></pre></td></tr></table></figure><p>关闭应用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -9 pid</span><br></pre></td></tr></table></figure><p>到这里为止,我们的饥荒已经成功启动了</p><p>下一篇我们来说mod<a href="/%E6%97%A0%E6%98%9F%E7%9A%84%E9%A5%A5%E8%8D%92%EF%BC%88%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94Mod">无星的饥荒（二）——Mod</a></p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://blog.csdn.net/D1179869625/article/details/122984871">Centos7 搭建FTP服务器</a></p><p><a href="https://zhuanlan.zhihu.com/p/146379848">饥荒搭建</a></p>]]></content:encoded>
      
      
      <category domain="http://blog.xingxiaowu.cn/categories/%E9%A5%A5%E8%8D%92/">饥荒</category>
      
      
      <category domain="http://blog.xingxiaowu.cn/tags/%E9%A5%A5%E8%8D%92/">饥荒</category>
      
      
      <comments>http://blog.xingxiaowu.cn/2022/10/03/%E6%97%A0%E6%98%9F%E7%9A%84%E9%A5%A5%E8%8D%92%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94%E5%AE%89%E8%A3%85/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>无星的自动化之旅（一）——PlayWright</title>
      <link>http://blog.xingxiaowu.cn/2022/09/11/%E6%97%A0%E6%98%9F%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B9%8B%E6%97%85%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94PlayWright/</link>
      <guid>http://blog.xingxiaowu.cn/2022/09/11/%E6%97%A0%E6%98%9F%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B9%8B%E6%97%85%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94PlayWright/</guid>
      <pubDate>Sun, 11 Sep 2022 07:27:08 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;工作上有些视频学习任务，一天到晚要看视频学习；&lt;/p&gt;
&lt;p&gt;关键还不能倍速，连播，非要手动点击下一个，非常苦恼。还时不时还跳一个弹窗出来，不回答就不继续播放，挂机都不行。&lt;/p&gt;
&lt;h1 id=&quot;技术选型&quot;&gt;&lt;a href=&quot;#技术选型&quot; class=&quot;headerlink&quot; title=&quot;技术选型&quot;&gt;&lt;/a&gt;技术选型&lt;/h1&gt;&lt;p&gt;&lt;code&gt;selenium&lt;/code&gt;，还用说吗？妥妥的大哥大&lt;/p&gt;
&lt;p&gt;&lt;code&gt;PlayWright&lt;/code&gt;，微软的新生儿&lt;/p&gt;
&lt;p&gt;所以我选&lt;code&gt;PlayWright&lt;/code&gt;&lt;/p&gt;
&lt;h1 id=&quot;在Linux上安装edge&quot;&gt;&lt;a href=&quot;#在Linux上安装edge&quot; class=&quot;headerlink&quot; title=&quot;在Linux上安装edge&quot;&gt;&lt;/a&gt;在Linux上安装edge&lt;/h1&gt;&lt;p&gt;问题来了，为什么要装&lt;code&gt;edge&lt;/code&gt;，&lt;code&gt;chrome&lt;/code&gt;不香么？&lt;/p&gt;
&lt;p&gt;但是有一个问题啊，通过&lt;code&gt;chromedriver&lt;/code&gt;调起来的是&lt;code&gt;chromium&lt;/code&gt;，&lt;code&gt;chromium&lt;/code&gt;默认不支持MP4封装h264编码的视频,默认只支持google自家的webm封装的VP9编码视频。&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>工作上有些视频学习任务，一天到晚要看视频学习；</p><p>关键还不能倍速，连播，非要手动点击下一个，非常苦恼。还时不时还跳一个弹窗出来，不回答就不继续播放，挂机都不行。</p><h1 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h1><p><code>selenium</code>，还用说吗？妥妥的大哥大</p><p><code>PlayWright</code>，微软的新生儿</p><p>所以我选<code>PlayWright</code></p><h1 id="在Linux上安装edge"><a href="#在Linux上安装edge" class="headerlink" title="在Linux上安装edge"></a>在Linux上安装edge</h1><p>问题来了，为什么要装<code>edge</code>，<code>chrome</code>不香么？</p><p>但是有一个问题啊，通过<code>chromedriver</code>调起来的是<code>chromium</code>，<code>chromium</code>默认不支持MP4封装h264编码的视频,默认只支持google自家的webm封装的VP9编码视频。</p><p>这不是要命，我最主要的需求就是看视频。</p><p>所以我们选择edge</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 在这里看可以安装的https://packages.microsoft.com/yumrepos/edge/</span><br><span class="line">sudo yum localinstall https://packages.microsoft.com/yumrepos/edge/microsoft-edge-stable-105.0.1343.27-1.x86_64.rpm</span><br><span class="line"># 可以使用看是否安装成功</span><br><span class="line">microsoft-edge --version</span><br></pre></td></tr></table></figure><h1 id="开启浏览器"><a href="#开启浏览器" class="headerlink" title="开启浏览器"></a>开启浏览器</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; chromium &#125; = <span class="built_in">require</span>(<span class="string">&#x27;playwright&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> browser = <span class="keyword">await</span> chromium.<span class="title function_">launch</span>(&#123;</span><br><span class="line">    <span class="comment">// 开发的时候写false，部署的时候使用true</span></span><br><span class="line">        <span class="attr">headless</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="comment">// 使用edge浏览器</span></span><br><span class="line">        <span class="attr">channel</span>: <span class="string">&#x27;msedge&#x27;</span>,</span><br><span class="line">        <span class="comment">// 默认开启控制台。不然无法自动播放视频</span></span><br><span class="line">        <span class="attr">devtools</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="通过XPath寻找dom"><a href="#通过XPath寻找dom" class="headerlink" title="通过XPath寻找dom"></a>通过XPath寻找dom</h1><p>好多兄弟问，XPath怎么搞，好难算，好复杂</p><p>说实话兄弟，根本不用自己写啊。。。。</p><p>举个栗子：<br><img src="/images/%E8%87%AA%E5%8A%A8%E5%8C%961/1.png" alt="1"></p><p>直接复制就行了。。。</p><h1 id="一些常用操作"><a href="#一些常用操作" class="headerlink" title="一些常用操作"></a>一些常用操作</h1><h3 id="1-聚焦input并输入"><a href="#1-聚焦input并输入" class="headerlink" title="1.聚焦input并输入"></a>1.聚焦<code>input</code>并输入</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 我这里使用id聚焦</span></span><br><span class="line">page.<span class="title function_">fill</span>(<span class="string">&#x27;#id&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="2-点击按钮"><a href="#2-点击按钮" class="headerlink" title="2.点击按钮"></a>2.点击按钮</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用xpath</span></span><br><span class="line"><span class="keyword">await</span> page.<span class="title function_">click</span>(<span class="string">&#x27;xpath=//html/body/form/div[2]/div/div[1]/input[4]&#x27;</span>)</span><br><span class="line"><span class="comment">// 使用文字定位</span></span><br><span class="line"><span class="keyword">await</span> page.<span class="title function_">click</span>(<span class="string">&#x27;text=&#x27;</span> + <span class="string">&#x27;登录&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="3-等待某个dom节点渲染完成"><a href="#3-等待某个dom节点渲染完成" class="headerlink" title="3.等待某个dom节点渲染完成"></a>3.等待某个dom节点渲染完成</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如我这里等待一张图片渲染完成后获取这个图片</span></span><br><span class="line"><span class="keyword">const</span> img0 = <span class="keyword">await</span> page.<span class="title function_">waitForSelector</span>(<span class="string">&#x27;id=Img0&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="4-获取所有可匹配成功的dom"><a href="#4-获取所有可匹配成功的dom" class="headerlink" title="4.获取所有可匹配成功的dom"></a>4.获取所有可匹配成功的dom</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在获取表格内所有列或者所有行时,尤为有效</span></span><br><span class="line"><span class="keyword">const</span> domlist = <span class="keyword">await</span> page.$$(<span class="string">&#x27;xpath=//*[@id=&quot;mian&quot;]/form/div/table/tbody/tr/td/table[2]/tbody/tr/td/table[1]/tbody/tr/td/table/tbody/tr/td[1]/table/tbody/tr/td[2]/table[4]/tbody/tr/td[3]/span&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="5-浏览器后退"><a href="#5-浏览器后退" class="headerlink" title="5.浏览器后退"></a>5.浏览器后退</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> page.<span class="title function_">goBack</span>()</span><br></pre></td></tr></table></figure><h3 id="6-拦截网络请求并替换结果"><a href="#6-拦截网络请求并替换结果" class="headerlink" title="6.拦截网络请求并替换结果"></a>6.拦截网络请求并替换结果</h3><p>在网络请求发起的页面,使用以下这个函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">forbidRequest</span> = <span class="keyword">async</span> (<span class="params">page</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 参数可以填请求地址或者正则表达式,例如:/aaa$/以aaa开头的请求</span></span><br><span class="line">    page.<span class="title function_">route</span>(<span class="string">&#x27;参数&#x27;</span>, <span class="keyword">async</span> route =&gt; &#123;</span><br><span class="line">        <span class="comment">// Fetch original response.</span></span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> page.<span class="property">request</span>.<span class="title function_">fetch</span>(route.<span class="title function_">request</span>());</span><br><span class="line">        <span class="comment">// Add a prefix to the title.</span></span><br><span class="line">        <span class="keyword">let</span> body = &#123;&#125;</span><br><span class="line">        <span class="comment">// 这里要注意,一定要转json字符串</span></span><br><span class="line">        <span class="keyword">const</span> result = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(body)</span><br><span class="line">        route.<span class="title function_">fulfill</span>(&#123;</span><br><span class="line">          <span class="comment">// Pass all fields from the response.</span></span><br><span class="line">          response,</span><br><span class="line">          <span class="comment">// Override response body.</span></span><br><span class="line">          <span class="attr">body</span>:result,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其他基本没啥了,跟着官网看文档就好了.</p>]]></content:encoded>
      
      
      <category domain="http://blog.xingxiaowu.cn/categories/PlayWright/">PlayWright</category>
      
      
      <category domain="http://blog.xingxiaowu.cn/tags/PlayWright/">PlayWright</category>
      
      
      <comments>http://blog.xingxiaowu.cn/2022/09/11/%E6%97%A0%E6%98%9F%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B9%8B%E6%97%85%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94PlayWright/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Postman批量请求并保存请求结果</title>
      <link>http://blog.xingxiaowu.cn/2022/09/06/Postman%E6%89%B9%E9%87%8F%E8%AF%B7%E6%B1%82%E5%B9%B6%E4%BF%9D%E5%AD%98%E8%AF%B7%E6%B1%82%E7%BB%93%E6%9E%9C/</link>
      <guid>http://blog.xingxiaowu.cn/2022/09/06/Postman%E6%89%B9%E9%87%8F%E8%AF%B7%E6%B1%82%E5%B9%B6%E4%BF%9D%E5%AD%98%E8%AF%B7%E6%B1%82%E7%BB%93%E6%9E%9C/</guid>
      <pubDate>Tue, 06 Sep 2022 09:24:00 GMT</pubDate>
      
      <description>&lt;h1 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h1&gt;&lt;p&gt;现在基本不怎么写代码了，偶尔会用技术去辅助业务。&lt;/p&gt;
&lt;p&gt;这次业务上碰到这样一个问题，要去采集客户系统的数据信息，之前是相关业务人员一页一页查，然后复制粘贴，所以我们使用postman进行批量请求，并保存结果&lt;/p&gt;
&lt;h2 id=&quot;1-设置请求变化参数&quot;&gt;&lt;a href=&quot;#1-设置请求变化参数&quot; class=&quot;headerlink&quot; title=&quot;1.设置请求变化参数&quot;&gt;&lt;/a&gt;1.设置请求变化参数&lt;/h2&gt;&lt;p&gt;假设前期的请求已经设置好了，那么接下来就是设置变化的参数&lt;/p&gt;
&lt;p&gt;其实肥肠简单，只要把相关参数设置为&lt;code&gt;&amp;#123;&amp;#123;参数名&amp;#125;&amp;#125;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;如下图&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/postman1/1.png&quot; alt=&quot;配置&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;2-放置待变化的参数，数组类型&quot;&gt;&lt;a href=&quot;#2-放置待变化的参数，数组类型&quot; class=&quot;headerlink&quot; title=&quot;2.放置待变化的参数，数组类型&quot;&gt;&lt;/a&gt;2.放置待变化的参数，数组类型&lt;/h2&gt;&lt;h3 id=&quot;2-1打开Run&quot;&gt;&lt;a href=&quot;#2-1打开Run&quot; class=&quot;headerlink&quot; title=&quot;2.1打开Run&quot;&gt;&lt;/a&gt;2.1打开&lt;code&gt;Run&lt;/code&gt;&lt;/h3&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>现在基本不怎么写代码了，偶尔会用技术去辅助业务。</p><p>这次业务上碰到这样一个问题，要去采集客户系统的数据信息，之前是相关业务人员一页一页查，然后复制粘贴，所以我们使用postman进行批量请求，并保存结果</p><h2 id="1-设置请求变化参数"><a href="#1-设置请求变化参数" class="headerlink" title="1.设置请求变化参数"></a>1.设置请求变化参数</h2><p>假设前期的请求已经设置好了，那么接下来就是设置变化的参数</p><p>其实肥肠简单，只要把相关参数设置为<code>&#123;&#123;参数名&#125;&#125;</code></p><p>如下图</p><p><img src="/images/postman1/1.png" alt="配置"></p><h2 id="2-放置待变化的参数，数组类型"><a href="#2-放置待变化的参数，数组类型" class="headerlink" title="2.放置待变化的参数，数组类型"></a>2.放置待变化的参数，数组类型</h2><h3 id="2-1打开Run"><a href="#2-1打开Run" class="headerlink" title="2.1打开Run"></a>2.1打开<code>Run</code></h3><p><img src="/images/postman1/2.png" alt="配置"></p><h3 id="2-2勾选相关配置"><a href="#2-2勾选相关配置" class="headerlink" title="2.2勾选相关配置"></a>2.2勾选相关配置</h3><p>勾选需要进行批量请求的接口，并将需要变化的值用数组的方式写在json文件里，<code>select file</code>选择相关文件</p><p>例如:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//aaa.json</span><br><span class="line">[&#123;</span><br><span class="line">    aaa:123,</span><br><span class="line">&#125;,&#123;</span><br><span class="line">    aaa:456,</span><br><span class="line">&#125;]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>当然也可以用<code>xlxs</code>等文件，这里就不做详解，开发常用的还是<code>json</code></p><p><img src="/images/postman1/3.png" alt="勾选内容"></p><h3 id="点击Run，此时会发现，看不到请求任何结果-。"><a href="#点击Run，此时会发现，看不到请求任何结果-。" class="headerlink" title="点击Run，此时会发现，看不到请求任何结果=。="></a>点击Run，此时会发现，看不到请求任何结果=。=</h3><h2 id="3-填写Test"><a href="#3-填写Test" class="headerlink" title="3.填写Test"></a>3.填写Test</h2><p>其实关键就是填写<code>Test</code>，通过<code>Test</code>将请求结果打印出来，或者只打印自己要的参数</p><p><code>Test</code>是填写测试用的，可以用来测试请求结果符合预期，就像写单元测试一样</p><p><img src="/images/postman1/4.png" alt="test"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pm.test(pm.response.json().data.XINGMING+&quot;,&quot;+pm.response.json().data.ZHENGJIANYXQ+&quot;,&quot;+pm.response.json().data.LIANXIFS+&quot;,&quot;+pm.response.json().data.HUJIDDWMC+&quot;,&quot;+pm.response.json().data.XIANCHANGZD,function ()&#123;</span><br><span class="line">    console.log(responseBody)</span><br><span class="line">    console.log(pm.response.body)</span><br><span class="line">    pm.expect(pm.response.text()).to.include(&quot;XINGMING&quot;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="4-再次run，等待请求结束，导出结果"><a href="#4-再次run，等待请求结束，导出结果" class="headerlink" title="4.再次run，等待请求结束，导出结果"></a>4.再次run，等待请求结束，导出结果</h2><p><img src="/images/postman1/5.png" alt="导出"></p><p><img src="/images/postman1/6.png" alt="结果"></p>]]></content:encoded>
      
      
      <category domain="http://blog.xingxiaowu.cn/categories/Postman/">Postman</category>
      
      
      <category domain="http://blog.xingxiaowu.cn/tags/Postman/">Postman</category>
      
      
      <comments>http://blog.xingxiaowu.cn/2022/09/06/Postman%E6%89%B9%E9%87%8F%E8%AF%B7%E6%B1%82%E5%B9%B6%E4%BF%9D%E5%AD%98%E8%AF%B7%E6%B1%82%E7%BB%93%E6%9E%9C/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>无星的党员学习笔记（六） —— 辛亥革命</title>
      <link>http://blog.xingxiaowu.cn/2022/05/16/%E6%97%A0%E6%98%9F%E7%9A%84%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%83%EF%BC%89/</link>
      <guid>http://blog.xingxiaowu.cn/2022/05/16/%E6%97%A0%E6%98%9F%E7%9A%84%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%83%EF%BC%89/</guid>
      <pubDate>Mon, 16 May 2022 09:15:00 GMT</pubDate>
      
      <description>&lt;p&gt;最近在读党史，记录一些随笔。&lt;/p&gt;
&lt;p&gt;孙中山先生是一位伟大的爱国主义者，也是中国民主革命的伟大先行者。&lt;/p&gt;
&lt;p&gt;三民主义由民族主义（Principles of Nationalism）、民权主义（Principles of Democracy）和民生主义（Principles of People’s Livelihood）组成。&lt;/p&gt;
&lt;p&gt;三民主义是孙中山先生民主思想的精髓和高度概括。&lt;/p&gt;
&lt;p&gt;孙中山先生创立的中国同盟会，以“驱除鞑虏，恢复中华，创立民国，平均地权”的十六字革命纲领，首次提出了要以资产阶级民主共和国取代封建王朝的革命目标。&lt;/p&gt;
&lt;p&gt;在同盟会成立后，革命党人开始了宣传工作，并积极联络军队，先后发起了一系列武装起义。如：广东潮州黄冈起义，惠州七女湖起义，广州起义等。这些奇艺虽然实质上是脱离人民群众的单纯军事行动，因而很快失败，但它反映了资产阶级革命党人反封建的精神，在全国不断扩大了影响力。&lt;/p&gt;
&lt;p&gt;最终，以湖北新军为主力，发起的武昌起义获得了全国各省的积极响应，迅速推翻了清王朝，建立了中华民国。&lt;/p&gt;
&lt;p&gt;1912年1月1日，孙中山在南京就任中华民国第一任临时大总统，发布《中华民国临时约法》，并颁布了多项新的政策政令，如：改国号为中华民国，不再跪拜，不再留长发，女子不再裹小脚等。反映出以孙中山先生为首的资产阶级革命派除旧布新，矢志共和的革命精神。&lt;/p&gt;
&lt;p&gt;辛亥革命的成功，在于它推翻了清王朝的封建统治，结束了中国几千年的君主专制制度，推动了中国人民思想解放。为中国的先进分子探索救国救民的道路，拓宽了视野，为中国的进步潮流打开了阀门。&lt;/p&gt;
&lt;p&gt;但辛亥革命也有弱点，没能提出明确的反帝反封建的革命纲领，加上帝国主义和封建势力在当时的力量强大，导致南京临时政府仅存在三个月，就被以袁世凯为代表的北洋军阀窃取了革命成果。因此从根本上讲，辛亥革命，既未能产出帝国主义和封建势力在中国的根基，也没能改变中国半殖民地半封建的社会性质。从这个角度看，辛亥革命并未成功。&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>最近在读党史，记录一些随笔。</p><p>孙中山先生是一位伟大的爱国主义者，也是中国民主革命的伟大先行者。</p><p>三民主义由民族主义（Principles of Nationalism）、民权主义（Principles of Democracy）和民生主义（Principles of People’s Livelihood）组成。</p><p>三民主义是孙中山先生民主思想的精髓和高度概括。</p><p>孙中山先生创立的中国同盟会，以“驱除鞑虏，恢复中华，创立民国，平均地权”的十六字革命纲领，首次提出了要以资产阶级民主共和国取代封建王朝的革命目标。</p><p>在同盟会成立后，革命党人开始了宣传工作，并积极联络军队，先后发起了一系列武装起义。如：广东潮州黄冈起义，惠州七女湖起义，广州起义等。这些奇艺虽然实质上是脱离人民群众的单纯军事行动，因而很快失败，但它反映了资产阶级革命党人反封建的精神，在全国不断扩大了影响力。</p><p>最终，以湖北新军为主力，发起的武昌起义获得了全国各省的积极响应，迅速推翻了清王朝，建立了中华民国。</p><p>1912年1月1日，孙中山在南京就任中华民国第一任临时大总统，发布《中华民国临时约法》，并颁布了多项新的政策政令，如：改国号为中华民国，不再跪拜，不再留长发，女子不再裹小脚等。反映出以孙中山先生为首的资产阶级革命派除旧布新，矢志共和的革命精神。</p><p>辛亥革命的成功，在于它推翻了清王朝的封建统治，结束了中国几千年的君主专制制度，推动了中国人民思想解放。为中国的先进分子探索救国救民的道路，拓宽了视野，为中国的进步潮流打开了阀门。</p><p>但辛亥革命也有弱点，没能提出明确的反帝反封建的革命纲领，加上帝国主义和封建势力在当时的力量强大，导致南京临时政府仅存在三个月，就被以袁世凯为代表的北洋军阀窃取了革命成果。因此从根本上讲，辛亥革命，既未能产出帝国主义和封建势力在中国的根基，也没能改变中国半殖民地半封建的社会性质。从这个角度看，辛亥革命并未成功。</p><p>尽管如此，辛亥革命仍然是中国人民为改变自己命运而崛起的一个伟大起点，后续的革命者们从辛亥革命未能解决中国所面临的基本问题这一事实中逐渐意识到，在中国半殖民地半封建社会的历史条件下，建立资产阶级民主共和国是不可能的，必须另外探索救国救民的新道路。</p>]]></content:encoded>
      
      
      <category domain="http://blog.xingxiaowu.cn/categories/%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">党员学习笔记</category>
      
      
      <category domain="http://blog.xingxiaowu.cn/tags/%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">党员学习笔记</category>
      
      
      <comments>http://blog.xingxiaowu.cn/2022/05/16/%E6%97%A0%E6%98%9F%E7%9A%84%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%83%EF%BC%89/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>无星的党员学习笔记（六） —— 资产阶级初登政治舞台</title>
      <link>http://blog.xingxiaowu.cn/2022/04/11/%E6%97%A0%E6%98%9F%E7%9A%84%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AD%EF%BC%89/</link>
      <guid>http://blog.xingxiaowu.cn/2022/04/11/%E6%97%A0%E6%98%9F%E7%9A%84%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AD%EF%BC%89/</guid>
      <pubDate>Mon, 11 Apr 2022 12:42:00 GMT</pubDate>
      
      <description>&lt;p&gt;最近在读党史，记录一些随笔。&lt;/p&gt;
&lt;p&gt;在近代中国，出现了两个新的阶级：资产阶级和无产阶级。&lt;/p&gt;
&lt;p&gt;自甲午战争失败，以康有为，谭嗣同，梁启超为代表的资产阶级维新派奋起，希望通过变法挽救国家，通过维新运动，试图仿照英日等资本主义，建立君主立宪制，以发展资本主义为目标开始自上而下的改革。历时103天，通过光绪皇帝下达变法诏书，希望能拯救中国，史称“百日维新”。&lt;/p&gt;
&lt;p&gt;但资产阶级维新派自身力量弱小，光绪皇帝没有实权，因此被封建顽固扼杀在摇篮里，戊戌六君子血洒菜市口。&lt;/p&gt;
&lt;p&gt;戊戌维新的失败表明，在近代中国，资产阶级改良主义道路是行不通的。&lt;/p&gt;
&lt;p&gt;这个时间段，各个阶级的有识之士都在探索，如何才能拯救国家，力挽狂澜。她们敏锐地意识到，落后就会挨打，所以无不希望通过学习西方的知识，武装自己，走上资本主义的富强道路。&lt;/p&gt;
&lt;p&gt;先进的中国人向西方学习经历了一个演进深化的过程：以林则徐，龚自珍，魏源为代表的第一代，要开眼看世界，师夷长技以制夷-&amp;gt;太平天国洪秀全明确支持《资政新篇》中的资本主义纲领-&amp;gt;洋务运动“自强求富”，希望“中体西用”。&lt;/p&gt;
&lt;p&gt;但是甲午海战的失败表明了洋务运动的破产。&lt;/p&gt;
&lt;p&gt;这时的中国，被八国联军侵占北京，积贫积弱，人民饥寒交迫，面临着亡国灭种。在这样日益深重的民族危机和社会危机下，近代中国民族民主革命所面临的反帝反封建任务更迫切的摆在中国人民面前。&lt;/p&gt;
&lt;h3 id=&quot;谁能领导中国人民求得民族独立和人民解放，谁就将成为中国革命的领导阶级&quot;&gt;&lt;a href=&quot;#谁能领导中国人民求得民族独立和人民解放，谁就将成为中国革命的领导阶级&quot; class=&quot;headerlink&quot; title=&quot;谁能领导中国人民求得民族独立和人民解放，谁就将成为中国革命的领导阶级&quot;&gt;&lt;/a&gt;谁能领导中国人民求得民族独立和人民解放，谁就将成为中国革命的领导阶级&lt;/h3&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>最近在读党史，记录一些随笔。</p><p>在近代中国，出现了两个新的阶级：资产阶级和无产阶级。</p><p>自甲午战争失败，以康有为，谭嗣同，梁启超为代表的资产阶级维新派奋起，希望通过变法挽救国家，通过维新运动，试图仿照英日等资本主义，建立君主立宪制，以发展资本主义为目标开始自上而下的改革。历时103天，通过光绪皇帝下达变法诏书，希望能拯救中国，史称“百日维新”。</p><p>但资产阶级维新派自身力量弱小，光绪皇帝没有实权，因此被封建顽固扼杀在摇篮里，戊戌六君子血洒菜市口。</p><p>戊戌维新的失败表明，在近代中国，资产阶级改良主义道路是行不通的。</p><p>这个时间段，各个阶级的有识之士都在探索，如何才能拯救国家，力挽狂澜。她们敏锐地意识到，落后就会挨打，所以无不希望通过学习西方的知识，武装自己，走上资本主义的富强道路。</p><p>先进的中国人向西方学习经历了一个演进深化的过程：以林则徐，龚自珍，魏源为代表的第一代，要开眼看世界，师夷长技以制夷-&gt;太平天国洪秀全明确支持《资政新篇》中的资本主义纲领-&gt;洋务运动“自强求富”，希望“中体西用”。</p><p>但是甲午海战的失败表明了洋务运动的破产。</p><p>这时的中国，被八国联军侵占北京，积贫积弱，人民饥寒交迫，面临着亡国灭种。在这样日益深重的民族危机和社会危机下，近代中国民族民主革命所面临的反帝反封建任务更迫切的摆在中国人民面前。</p><h3 id="谁能领导中国人民求得民族独立和人民解放，谁就将成为中国革命的领导阶级"><a href="#谁能领导中国人民求得民族独立和人民解放，谁就将成为中国革命的领导阶级" class="headerlink" title="谁能领导中国人民求得民族独立和人民解放，谁就将成为中国革命的领导阶级"></a>谁能领导中国人民求得民族独立和人民解放，谁就将成为中国革命的领导阶级</h3>]]></content:encoded>
      
      
      <category domain="http://blog.xingxiaowu.cn/categories/%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">党员学习笔记</category>
      
      
      <category domain="http://blog.xingxiaowu.cn/tags/%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">党员学习笔记</category>
      
      
      <comments>http://blog.xingxiaowu.cn/2022/04/11/%E6%97%A0%E6%98%9F%E7%9A%84%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AD%EF%BC%89/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>无星的党员学习笔记（五） —— 近代中国人民革命的兴起</title>
      <link>http://blog.xingxiaowu.cn/2022/03/26/%E6%97%A0%E6%98%9F%E7%9A%84%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89/</link>
      <guid>http://blog.xingxiaowu.cn/2022/03/26/%E6%97%A0%E6%98%9F%E7%9A%84%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89/</guid>
      <pubDate>Sat, 26 Mar 2022 11:12:00 GMT</pubDate>
      
      <description>&lt;p&gt;最近在读党史，记录一些随笔。&lt;/p&gt;
&lt;p&gt;从鸦片战争开始，中国的仁人志士就开始同帝国主义和封建势力开始了斗争。从最早的广东三元里抗英斗争，到义和团，太平天国运动。无数的仁人志士前仆后继，抛头颅洒热血，显示出中国人民不屈不挠的反侵略反压迫的坚强意志和斗争精神。“我自横刀向天笑，去留肝胆两昆仑”——谭嗣同。&lt;/p&gt;
&lt;p&gt;反帝反封建斗争的主力最初是农民，其实从历史就能看出来，自古封建统治阶级压迫农民，当农民日子过不下去了，就会起义。&lt;/p&gt;
&lt;p&gt;农民战争是封建社会阶级斗争的产物。“封建社会的主要矛盾，是农民阶级和地主阶级的矛盾。”（《毛泽东选集》第2卷第625页）&lt;/p&gt;
&lt;p&gt;但是历史上的农民起义，哪怕成功了，也没有改善农民的生活水平，只是有一批“农民阶级”通过起义跃迁到了“地主阶级”。&lt;/p&gt;
&lt;p&gt;太平天国是近代以来，旧式农民战争的巅峰！而且太平天国发布了中国农民战争史上的第一个完整土地纲领——《天朝田亩制度》，虽然因为其带有空想色彩难以落地，但它反映了千百年来，农民对拥有自己土地的渴望，对于发动农民参与反封建斗争起到了非常积极的作用。&lt;/p&gt;
&lt;p&gt;太平天国爆发出的力量，让帝国主义者看到了中国蕴藏的巨大反抗力量，让他们知道，如此“民气坚韧”的中国是不可征服的。&lt;/p&gt;
&lt;p&gt;但是农民不代表新的生产方式，提不出科学的有远见的斗争纲领，不能战胜强大的敌人。在中外反动势力的镇压下，农民斗争以一次又一次的失败告终。在半封建半殖民的中国，太平天国和义和团运动证明：农民固然是一只强大的反帝反封建主力军，但是如果没有先进阶级的领导，是无法完成反帝反封建的历史任务的。&lt;/p&gt;
</description>
      
      
      
      <content:encoded><![CDATA[<p>最近在读党史，记录一些随笔。</p><p>从鸦片战争开始，中国的仁人志士就开始同帝国主义和封建势力开始了斗争。从最早的广东三元里抗英斗争，到义和团，太平天国运动。无数的仁人志士前仆后继，抛头颅洒热血，显示出中国人民不屈不挠的反侵略反压迫的坚强意志和斗争精神。“我自横刀向天笑，去留肝胆两昆仑”——谭嗣同。</p><p>反帝反封建斗争的主力最初是农民，其实从历史就能看出来，自古封建统治阶级压迫农民，当农民日子过不下去了，就会起义。</p><p>农民战争是封建社会阶级斗争的产物。“封建社会的主要矛盾，是农民阶级和地主阶级的矛盾。”（《毛泽东选集》第2卷第625页）</p><p>但是历史上的农民起义，哪怕成功了，也没有改善农民的生活水平，只是有一批“农民阶级”通过起义跃迁到了“地主阶级”。</p><p>太平天国是近代以来，旧式农民战争的巅峰！而且太平天国发布了中国农民战争史上的第一个完整土地纲领——《天朝田亩制度》，虽然因为其带有空想色彩难以落地，但它反映了千百年来，农民对拥有自己土地的渴望，对于发动农民参与反封建斗争起到了非常积极的作用。</p><p>太平天国爆发出的力量，让帝国主义者看到了中国蕴藏的巨大反抗力量，让他们知道，如此“民气坚韧”的中国是不可征服的。</p><p>但是农民不代表新的生产方式，提不出科学的有远见的斗争纲领，不能战胜强大的敌人。在中外反动势力的镇压下，农民斗争以一次又一次的失败告终。在半封建半殖民的中国，太平天国和义和团运动证明：农民固然是一只强大的反帝反封建主力军，但是如果没有先进阶级的领导，是无法完成反帝反封建的历史任务的。</p>]]></content:encoded>
      
      
      <category domain="http://blog.xingxiaowu.cn/categories/%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">党员学习笔记</category>
      
      
      <category domain="http://blog.xingxiaowu.cn/tags/%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">党员学习笔记</category>
      
      
      <comments>http://blog.xingxiaowu.cn/2022/03/26/%E6%97%A0%E6%98%9F%E7%9A%84%E5%85%9A%E5%91%98%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>无星的electron之旅（十三）—— 复制图片到剪切板</title>
      <link>http://blog.xingxiaowu.cn/2022/03/03/%E6%97%A0%E6%98%9F%E7%9A%84electron%E4%B9%8B%E6%97%85%EF%BC%88%E5%8D%81%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94%20%E5%A4%8D%E5%88%B6%E5%9B%BE%E7%89%87%E5%88%B0%E5%89%AA%E5%88%87%E6%9D%BF/</link>
      <guid>http://blog.xingxiaowu.cn/2022/03/03/%E6%97%A0%E6%98%9F%E7%9A%84electron%E4%B9%8B%E6%97%85%EF%BC%88%E5%8D%81%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94%20%E5%A4%8D%E5%88%B6%E5%9B%BE%E7%89%87%E5%88%B0%E5%89%AA%E5%88%87%E6%9D%BF/</guid>
      <pubDate>Thu, 03 Mar 2022 10:32:54 GMT</pubDate>
      
      <description>&lt;h2 id=&quot;一、背景&quot;&gt;&lt;a href=&quot;#一、背景&quot; class=&quot;headerlink&quot; title=&quot;一、背景&quot;&gt;&lt;/a&gt;一、背景&lt;/h2&gt;&lt;p&gt;需求变更。。。仅此而已&lt;/p&gt;
&lt;h2 id=&quot;二、如何实现&quot;&gt;&lt;a href=&quot;#二、如何实现&quot; class=&quot;headerlink&quot; title=&quot;二、如何实现&quot;&gt;&lt;/a&gt;二、如何实现&lt;/h2&gt;&lt;p&gt;通过上一篇，我们已经知道了如何获取dom节点&lt;/p&gt;
&lt;p&gt;接下来要做的，则是将图片复制到剪切板&lt;/p&gt;
&lt;p&gt;我们从文档可以看到&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.electronjs.org/zh/docs/latest/api/native-image#nativeimagecreatefromnamedimageimagename-hslshift-macos&quot;&gt;clipboard.writeImage&lt;/a&gt;&lt;br&gt;&lt;code&gt;clipboard&lt;/code&gt;支持读写图片到剪切板，但必须是&lt;code&gt;nativeimage&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.electronjs.org/zh/docs/latest/api/native-image#nativeimagecreatefromdataurldataurl&quot;&gt;nativeimage.createFromDataURL&lt;/a&gt;&lt;br&gt;而&lt;code&gt;nativeimage&lt;/code&gt;可以支持从base64创建&lt;/p&gt;
&lt;p&gt;那么配合上一篇，我们拿到base64以后，通过这个操作，就可以复制图片到剪切板了&lt;/p&gt;
&lt;p&gt;代码如下&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h2><p>需求变更。。。仅此而已</p><h2 id="二、如何实现"><a href="#二、如何实现" class="headerlink" title="二、如何实现"></a>二、如何实现</h2><p>通过上一篇，我们已经知道了如何获取dom节点</p><p>接下来要做的，则是将图片复制到剪切板</p><p>我们从文档可以看到</p><p><a href="https://www.electronjs.org/zh/docs/latest/api/native-image#nativeimagecreatefromnamedimageimagename-hslshift-macos">clipboard.writeImage</a><br><code>clipboard</code>支持读写图片到剪切板，但必须是<code>nativeimage</code></p><p><a href="https://www.electronjs.org/zh/docs/latest/api/native-image#nativeimagecreatefromdataurldataurl">nativeimage.createFromDataURL</a><br>而<code>nativeimage</code>可以支持从base64创建</p><p>那么配合上一篇，我们拿到base64以后，通过这个操作，就可以复制图片到剪切板了</p><p>代码如下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// html 入口文件</span></span><br><span class="line"><span class="comment">///////////</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;contextmenu&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.<span class="title function_">preventDefault</span>();</span><br><span class="line">  <span class="keyword">const</span> domName = e.<span class="property">target</span>.<span class="property">localName</span>;</span><br><span class="line">  <span class="keyword">if</span> (domName === <span class="string">&quot;img&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="property">id</span> === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">valueOf</span>();</span><br><span class="line">      e.<span class="property">target</span>.<span class="property">id</span> = date;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">rightMenu</span>.<span class="title function_">show</span>(e.<span class="property">target</span>.<span class="property">id</span>, e.<span class="property">target</span>.<span class="property">currentSrc</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">///////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// background.js</span></span><br><span class="line"><span class="comment">///////////</span></span><br><span class="line"><span class="keyword">const</span> rightMenu = <span class="title function_">initRightMenu</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRightMenu</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> rightTemplate = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">label</span>: <span class="string">&quot;复制图片&quot;</span>,</span><br><span class="line">      <span class="attr">click</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;复制图片&quot;</span>);</span><br><span class="line">        mainWindow.<span class="property">webContents</span>.<span class="title function_">send</span>(<span class="string">&quot;copyImage&quot;</span>, &#123;</span><br><span class="line">          <span class="attr">domId</span>: clickDomId,</span><br><span class="line">          <span class="attr">imageUrl</span>:clickImageUrl</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">const</span> menu = <span class="title class_">Menu</span>.<span class="title function_">buildFromTemplate</span>(rightTemplate);</span><br><span class="line">  <span class="keyword">return</span> menu;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> clickDomId = <span class="literal">null</span></span><br><span class="line"><span class="keyword">let</span> clickImageUrl = <span class="literal">null</span></span><br><span class="line">ipcMain.<span class="title function_">handle</span>(<span class="string">&quot;show-context-menu&quot;</span>, <span class="function">(<span class="params">event, args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; domId,imageUrl &#125; = args;</span><br><span class="line">  clickDomId = domId;</span><br><span class="line">  clickImageUrl = imageUrl;</span><br><span class="line">  rightMenu.<span class="title function_">popup</span>(&#123;</span><br><span class="line">    <span class="attr">window</span>: mainWindow.<span class="property">webContents</span>,</span><br><span class="line">    <span class="attr">callback</span>: <span class="function">() =&gt;</span> (clickDomId = <span class="literal">null</span>),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">///////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// preload.js</span></span><br><span class="line"><span class="comment">///////////</span></span><br><span class="line"><span class="comment">// 注入时使用，可不在html入口处添加监听</span></span><br><span class="line"><span class="comment">// document.addEventListener(&quot;DOMContentLoaded&quot;, () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   window.addEventListener(&quot;contextmenu&quot;, (e) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     e.preventDefault();</span></span><br><span class="line"><span class="comment">//     const domName = e.target.localName;</span></span><br><span class="line"><span class="comment">//     if (domName === &quot;img&quot;) &#123;</span></span><br><span class="line"><span class="comment">//       if (e.target.id === &quot;&quot;) &#123;</span></span><br><span class="line"><span class="comment">//         const date = new Date().valueOf();</span></span><br><span class="line"><span class="comment">//         e.target.id = date;</span></span><br><span class="line"><span class="comment">//       &#125;</span></span><br><span class="line"><span class="comment">//       ipcRenderer.invoke(&quot;show-context-menu&quot;, &#123;</span></span><br><span class="line"><span class="comment">//         domId: e.target.id,</span></span><br><span class="line"><span class="comment">//         imageUrl: e.target.currentSrc</span></span><br><span class="line"><span class="comment">//       &#125;);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//   &#125;);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line">contextBridge.<span class="title function_">exposeInMainWorld</span>(<span class="string">&quot;rightMenu&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">show</span>: <span class="function">(<span class="params">domId,currentSrc</span>) =&gt;</span></span><br><span class="line">    ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&quot;show-context-menu&quot;</span>, &#123;</span><br><span class="line">      domId,currentSrc</span><br><span class="line">    &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ipcRenderer.<span class="title function_">on</span>(<span class="string">&quot;copyImage&quot;</span>, <span class="function">(<span class="params">event, args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; domId,imageUrl &#125; = args;</span><br><span class="line">  <span class="title function_">imageToBase64</span>(imageUrl)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">imageToBase64</span> = (<span class="params">url</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> image = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">    image.<span class="property">crossOrigin</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    image.<span class="property">src</span> = url;</span><br><span class="line">    image.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> base64 = <span class="title function_">getBase64Image</span>(image);</span><br><span class="line">      <span class="keyword">const</span> img = nativeImage.<span class="title function_">createFromDataURL</span>(base64)</span><br><span class="line">      clipboard.<span class="title function_">writeImage</span>(img)</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getBase64Image</span> = (<span class="params">img</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">  canvas.<span class="property">width</span> = img.<span class="property">width</span>;</span><br><span class="line">  canvas.<span class="property">height</span> = img.<span class="property">height</span>;</span><br><span class="line">  <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">  ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>, img.<span class="property">width</span>, img.<span class="property">height</span>);</span><br><span class="line">  <span class="keyword">let</span> ext = img.<span class="property">src</span>.<span class="title function_">substring</span>(img.<span class="property">src</span>.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>).<span class="title function_">toLowerCase</span>();</span><br><span class="line">  <span class="keyword">if</span> (ext === <span class="string">&quot;jpg&quot;</span>) &#123;</span><br><span class="line">    ext = <span class="string">&quot;jpeg&quot;</span>; <span class="comment">//这个地方是由于如果是jpg, 他会识别成image/png</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> dataURL = canvas.<span class="title function_">toDataURL</span>(<span class="string">&quot;image/&quot;</span> + ext);</span><br><span class="line">  <span class="keyword">return</span> dataURL;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">///////////</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><p><img src="/images/electron13/1.gif" alt="1"></p>]]></content:encoded>
      
      
      <category domain="http://blog.xingxiaowu.cn/categories/electron/">electron</category>
      
      
      <category domain="http://blog.xingxiaowu.cn/tags/electron/">electron</category>
      
      
      <comments>http://blog.xingxiaowu.cn/2022/03/03/%E6%97%A0%E6%98%9F%E7%9A%84electron%E4%B9%8B%E6%97%85%EF%BC%88%E5%8D%81%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94%20%E5%A4%8D%E5%88%B6%E5%9B%BE%E7%89%87%E5%88%B0%E5%89%AA%E5%88%87%E6%9D%BF/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>无星的electron之旅（十二）—— 如何像浏览器一样制作右键菜单</title>
      <link>http://blog.xingxiaowu.cn/2022/03/02/%E6%97%A0%E6%98%9F%E7%9A%84electron%E4%B9%8B%E6%97%85%EF%BC%88%E5%8D%81%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94%20%E5%A6%82%E4%BD%95%E5%83%8F%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%80%E6%A0%B7%E5%88%B6%E4%BD%9C%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95/</link>
      <guid>http://blog.xingxiaowu.cn/2022/03/02/%E6%97%A0%E6%98%9F%E7%9A%84electron%E4%B9%8B%E6%97%85%EF%BC%88%E5%8D%81%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94%20%E5%A6%82%E4%BD%95%E5%83%8F%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%80%E6%A0%B7%E5%88%B6%E4%BD%9C%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95/</guid>
      <pubDate>Wed, 02 Mar 2022 15:32:54 GMT</pubDate>
      
      <description>&lt;h2 id=&quot;一、背景&quot;&gt;&lt;a href=&quot;#一、背景&quot; class=&quot;headerlink&quot; title=&quot;一、背景&quot;&gt;&lt;/a&gt;一、背景&lt;/h2&gt;&lt;p&gt;接了个小需求，已有网站，做了个electron的壳，需要添加右键菜单&lt;br&gt;1.复制图片为base64&lt;br&gt;2.另存为图片&lt;br&gt;3.复制图片地址&lt;/p&gt;
&lt;h2 id=&quot;二、首先需要添加右键菜单&quot;&gt;&lt;a href=&quot;#二、首先需要添加右键菜单&quot; class=&quot;headerlink&quot; title=&quot;二、首先需要添加右键菜单&quot;&gt;&lt;/a&gt;二、首先需要添加右键菜单&lt;/h2&gt;&lt;h2 id=&quot;1-主线程-background-js添加右键菜单内容&quot;&gt;&lt;a href=&quot;#1-主线程-background-js添加右键菜单内容&quot; class=&quot;headerlink&quot; title=&quot;1.主线程 background.js添加右键菜单内容&quot;&gt;&lt;/a&gt;1.主线程 background.js添加右键菜单内容&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// background.js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;///////////&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; rightMenu = &lt;span class=&quot;title function_&quot;&gt;initRightMenu&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;initRightMenu&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; rightTemplate = [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;label&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;quot;复制图片为base64&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;click&lt;/span&gt;: &lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;复制图片为base64&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;label&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;quot;另存为图片&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;click&lt;/span&gt;: &lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;另存为图片&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;label&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;quot;复制图片URL&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;click&lt;/span&gt;: &lt;span class=&quot;function&quot;&gt;() =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;复制图片URL&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; menu = &lt;span class=&quot;title class_&quot;&gt;Menu&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;buildFromTemplate&lt;/span&gt;(rightTemplate);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; menu;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;///////////&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;2-页面右键要能调用&quot;&gt;&lt;a href=&quot;#2-页面右键要能调用&quot; class=&quot;headerlink&quot; title=&quot;2.页面右键要能调用&quot;&gt;&lt;/a&gt;2.页面右键要能调用&lt;/h2&gt;&lt;p&gt;需要页面右键能够响应&lt;/p&gt;
&lt;p&gt;那么我们需要在页面上能够获取到右键的点击事件&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 页面入口，比如vue的main.js&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;variable language_&quot;&gt;window&lt;/span&gt;.&lt;span class=&quot;title function_&quot;&gt;addEventListener&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;contextmenu&amp;quot;&lt;/span&gt;, &lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;e&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  e.&lt;span class=&quot;title function_&quot;&gt;preventDefault&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;comment&quot;&gt;// TODO 通知主线程&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&quot;3-通知主线程响应&quot;&gt;&lt;a href=&quot;#3-通知主线程响应&quot; class=&quot;headerlink&quot; title=&quot;3.通知主线程响应&quot;&gt;&lt;/a&gt;3.通知主线程响应&lt;/h2&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h2><p>接了个小需求，已有网站，做了个electron的壳，需要添加右键菜单<br>1.复制图片为base64<br>2.另存为图片<br>3.复制图片地址</p><h2 id="二、首先需要添加右键菜单"><a href="#二、首先需要添加右键菜单" class="headerlink" title="二、首先需要添加右键菜单"></a>二、首先需要添加右键菜单</h2><h2 id="1-主线程-background-js添加右键菜单内容"><a href="#1-主线程-background-js添加右键菜单内容" class="headerlink" title="1.主线程 background.js添加右键菜单内容"></a>1.主线程 background.js添加右键菜单内容</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// background.js</span></span><br><span class="line"><span class="comment">///////////</span></span><br><span class="line"><span class="keyword">const</span> rightMenu = <span class="title function_">initRightMenu</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initRightMenu</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> rightTemplate = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">label</span>: <span class="string">&quot;复制图片为base64&quot;</span>,</span><br><span class="line">      <span class="attr">click</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;复制图片为base64&quot;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">label</span>: <span class="string">&quot;另存为图片&quot;</span>,</span><br><span class="line">      <span class="attr">click</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;另存为图片&quot;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">label</span>: <span class="string">&quot;复制图片URL&quot;</span>,</span><br><span class="line">      <span class="attr">click</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;复制图片URL&quot;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">const</span> menu = <span class="title class_">Menu</span>.<span class="title function_">buildFromTemplate</span>(rightTemplate);</span><br><span class="line">  <span class="keyword">return</span> menu;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">///////////</span></span><br></pre></td></tr></table></figure><h2 id="2-页面右键要能调用"><a href="#2-页面右键要能调用" class="headerlink" title="2.页面右键要能调用"></a>2.页面右键要能调用</h2><p>需要页面右键能够响应</p><p>那么我们需要在页面上能够获取到右键的点击事件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 页面入口，比如vue的main.js</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;contextmenu&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.<span class="title function_">preventDefault</span>();</span><br><span class="line">  <span class="comment">// TODO 通知主线程</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="3-通知主线程响应"><a href="#3-通知主线程响应" class="headerlink" title="3.通知主线程响应"></a>3.通知主线程响应</h2><p>通过<code>preload</code>为window对象挂上一个<code>rightMenu</code>属性用于沟通调用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// preload.js</span></span><br><span class="line">contextBridge.<span class="title function_">exposeInMainWorld</span>(<span class="string">&quot;rightMenu&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">show</span>: <span class="function">(<span class="params">domId</span>) =&gt;</span></span><br><span class="line">    ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&quot;show-context-menu&quot;</span>, &#123;</span><br><span class="line">      domId,</span><br><span class="line">    &#125;),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;contextmenu&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.<span class="title function_">preventDefault</span>();</span><br><span class="line">  <span class="keyword">const</span> domName = e.<span class="property">target</span>.<span class="property">localName</span>;</span><br><span class="line">  <span class="keyword">if</span> (domName === <span class="string">&quot;img&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="property">id</span> === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">valueOf</span>();</span><br><span class="line">      e.<span class="property">target</span>.<span class="property">id</span> = date;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">rightMenu</span>.<span class="title function_">show</span>(e.<span class="property">target</span>.<span class="property">id</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>因为我们的目标是图片，所以判断一下，是图片才调用右键展示</p><p>同时我们需要知道我们需要操作哪个dom，所以为其设置一个id，方便后续操作</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// background.js</span></span><br><span class="line">ipcMain.<span class="title function_">handle</span>(<span class="string">&quot;show-context-menu&quot;</span>, <span class="function">(<span class="params">event, args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; domId &#125; = args;</span><br><span class="line">  clickDomId = domId;</span><br><span class="line">  rightMenu.<span class="title function_">popup</span>(&#123;</span><br><span class="line">    <span class="attr">window</span>: <span class="title class_">BrowserWindow</span>.<span class="title function_">getFocusedWindow</span>().<span class="property">webContents</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>展示</p><h2 id="4-实现内容"><a href="#4-实现内容" class="headerlink" title="4.实现内容"></a>4.实现内容</h2><p>好像有点简单，随便百度了几个方法，就不多说了，直接放代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// preload.js</span></span><br><span class="line">ipcRenderer.<span class="title function_">on</span>(<span class="string">&quot;base64&quot;</span>, <span class="function">(<span class="params">event, args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; domId &#125; = args;</span><br><span class="line">  <span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(domId);</span><br><span class="line">  <span class="title function_">imageToBase64</span>(element.<span class="property">currentSrc</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ipcRenderer.<span class="title function_">on</span>(<span class="string">&quot;saveImage&quot;</span>, <span class="function">(<span class="params">event, args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; domId &#125; = args;</span><br><span class="line">  <span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(domId);</span><br><span class="line">  <span class="keyword">const</span> nameArray = element.<span class="property">currentSrc</span>.<span class="title function_">split</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> tmpArray = nameArray[nameArray.<span class="property">length</span> - <span class="number">1</span>].<span class="title function_">split</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> name = tmpArray[<span class="number">0</span>];</span><br><span class="line">  <span class="comment">// console.log(nameArray);</span></span><br><span class="line">  <span class="title function_">download</span>(element.<span class="property">currentSrc</span>, name);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ipcRenderer.<span class="title function_">on</span>(<span class="string">&quot;copyUrl&quot;</span>, <span class="function">(<span class="params">event, args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; domId &#125; = args;</span><br><span class="line">  <span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(domId);</span><br><span class="line">  <span class="title function_">copy</span>(element.<span class="property">currentSrc</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// base64</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getBase64Image</span> = (<span class="params">img</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">  canvas.<span class="property">width</span> = img.<span class="property">width</span>;</span><br><span class="line">  canvas.<span class="property">height</span> = img.<span class="property">height</span>;</span><br><span class="line">  <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">  ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>, img.<span class="property">width</span>, img.<span class="property">height</span>);</span><br><span class="line">  <span class="keyword">let</span> ext = img.<span class="property">src</span>.<span class="title function_">substring</span>(img.<span class="property">src</span>.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>).<span class="title function_">toLowerCase</span>();</span><br><span class="line">  <span class="keyword">if</span> (ext === <span class="string">&quot;jpg&quot;</span>) &#123;</span><br><span class="line">    ext = <span class="string">&quot;jpeg&quot;</span>; <span class="comment">//这个地方是由于如果是jpg, 他会识别成image/png</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> dataURL = canvas.<span class="title function_">toDataURL</span>(<span class="string">&quot;image/&quot;</span> + ext);</span><br><span class="line">  <span class="keyword">return</span> dataURL;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">imageToBase64</span> = (<span class="params">url</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> image = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">  image.<span class="property">crossOrigin</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  image.<span class="property">src</span> = url;</span><br><span class="line">  image.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> base64 = <span class="title function_">getBase64Image</span>(image);</span><br><span class="line">    <span class="comment">// console.log(base64);</span></span><br><span class="line">    <span class="title function_">copy</span>(base64);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">download</span> = (<span class="params">data, name</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!data) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getUrlBase64</span>(data).<span class="title function_">then</span>(<span class="function">(<span class="params">base64</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    a.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span><br><span class="line">    a.<span class="property">download</span> = name;</span><br><span class="line">    a.<span class="property">href</span> = base64;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(a);</span><br><span class="line">    a.<span class="title function_">click</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getUrlBase64</span> = (<span class="params">url</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">    <span class="keyword">let</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">    img.<span class="property">crossOrigin</span> = <span class="string">&quot;Anonymous&quot;</span>; <span class="comment">//允许跨域</span></span><br><span class="line">    img.<span class="property">src</span> = url;</span><br><span class="line">    img.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      canvas.<span class="property">height</span> = <span class="number">300</span>;</span><br><span class="line">      canvas.<span class="property">width</span> = <span class="number">300</span>;</span><br><span class="line">      ctx.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>, <span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">      <span class="keyword">let</span> dataURL = canvas.<span class="title function_">toDataURL</span>(<span class="string">&quot;image/png&quot;</span>);</span><br><span class="line">      canvas = <span class="literal">null</span>;</span><br><span class="line">      <span class="title function_">resolve</span>(dataURL);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="那么如果是加载别人远程页面，没有页面代码，比如我们是个浏览器，如何实现这个功能？"><a href="#那么如果是加载别人远程页面，没有页面代码，比如我们是个浏览器，如何实现这个功能？" class="headerlink" title="那么如果是加载别人远程页面，没有页面代码，比如我们是个浏览器，如何实现这个功能？"></a>那么如果是加载别人远程页面，没有页面代码，比如我们是个浏览器，如何实现这个功能？</h1><p>其实也有方法，我们可以通过注入的方式去做</p><p>可见<a href="https://blog.xingxiaowu.cn/2021/01/03/%E6%97%A0%E6%98%9F%E7%9A%84electron%E4%B9%8B%E6%97%85%EF%BC%88%E4%B9%9D%EF%BC%89%E2%80%94%E2%80%94%20JS%E6%B3%A8%E5%85%A5/">无星的electron之旅（九）—— JS注入</a></p><p>在页面加载完成以后，通过<code>preload</code>注入代码即可</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// preload.js</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 页面内容加载之后需要引入的一些操作</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;contextmenu&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="keyword">const</span> domName = e.<span class="property">target</span>.<span class="property">localName</span>;</span><br><span class="line">    <span class="keyword">if</span> (domName === <span class="string">&quot;img&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="property">id</span> === <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">valueOf</span>();</span><br><span class="line">        e.<span class="property">target</span>.<span class="property">id</span> = date;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// window.rightMenu.show(e.target.id);</span></span><br><span class="line">      ipcRenderer.<span class="title function_">invoke</span>(<span class="string">&quot;show-context-menu&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">domId</span>: e.<span class="property">target</span>.<span class="property">id</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>通过这段代码，我们可以为不同样式标签添加不同操作，并且不需要修改网页代码，自然像浏览器一样，添加右键菜单</p><h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><p><img src="/images/electron12/1.gif" alt="1"></p>]]></content:encoded>
      
      
      <category domain="http://blog.xingxiaowu.cn/categories/electron/">electron</category>
      
      
      <category domain="http://blog.xingxiaowu.cn/tags/electron/">electron</category>
      
      
      <comments>http://blog.xingxiaowu.cn/2022/03/02/%E6%97%A0%E6%98%9F%E7%9A%84electron%E4%B9%8B%E6%97%85%EF%BC%88%E5%8D%81%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94%20%E5%A6%82%E4%BD%95%E5%83%8F%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%80%E6%A0%B7%E5%88%B6%E4%BD%9C%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>无星的electron之旅（十一）—— 阿星的electron打包页面</title>
      <link>http://blog.xingxiaowu.cn/2022/02/21/%E6%97%A0%E6%98%9F%E7%9A%84electron%E4%B9%8B%E6%97%85%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94%20%E9%98%BF%E6%98%9F%E7%9A%84electron%E6%89%93%E5%8C%85%E9%A1%B5%E9%9D%A2/</link>
      <guid>http://blog.xingxiaowu.cn/2022/02/21/%E6%97%A0%E6%98%9F%E7%9A%84electron%E4%B9%8B%E6%97%85%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94%20%E9%98%BF%E6%98%9F%E7%9A%84electron%E6%89%93%E5%8C%85%E9%A1%B5%E9%9D%A2/</guid>
      <pubDate>Mon, 21 Feb 2022 14:32:54 GMT</pubDate>
      
      <description>&lt;h2 id=&quot;一、背景&quot;&gt;&lt;a href=&quot;#一、背景&quot; class=&quot;headerlink&quot; title=&quot;一、背景&quot;&gt;&lt;/a&gt;一、背景&lt;/h2&gt;&lt;p&gt;因为用的是mac，发现有些网站不提供mac的应用版，所以很不爽，想自己打包&lt;/p&gt;
&lt;p&gt;其实也有些企业做好了网站，想套个壳直接做成应用&lt;/p&gt;
&lt;p&gt;因此我用我毕生功力，做了个打包页面，快速产壳&lt;/p&gt;
&lt;h2 id=&quot;二、地址&quot;&gt;&lt;a href=&quot;#二、地址&quot; class=&quot;headerlink&quot; title=&quot;二、地址&quot;&gt;&lt;/a&gt;二、地址&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://blog.xingxiaowu.cn/electron&quot;&gt;阿星的打包页面&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;依次输入我需要的参数&lt;/p&gt;
&lt;p&gt;例如:&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;客户端需要打包的url地址: https://www.bilibili.com/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;客户端名称: bilibili&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;客户端appid: com.bilibili.app&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;接收应用程序的邮箱: 329106954@qq.com&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后选择需要打包的平台&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h2><p>因为用的是mac，发现有些网站不提供mac的应用版，所以很不爽，想自己打包</p><p>其实也有些企业做好了网站，想套个壳直接做成应用</p><p>因此我用我毕生功力，做了个打包页面，快速产壳</p><h2 id="二、地址"><a href="#二、地址" class="headerlink" title="二、地址"></a>二、地址</h2><p><a href="https://blog.xingxiaowu.cn/electron">阿星的打包页面</a></p><p>依次输入我需要的参数</p><p>例如:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">客户端需要打包的url地址: https://www.bilibili.com/</span><br><span class="line"></span><br><span class="line">客户端名称: bilibili</span><br><span class="line"></span><br><span class="line">客户端appid: com.bilibili.app</span><br><span class="line"></span><br><span class="line">接收应用程序的邮箱: 329106954@qq.com</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后选择需要打包的平台</p><p>然后就可以前往查看构建进度</p><p><img src="/images/electron10/1.png" alt="1"></p><p><img src="/images/electron10/2.png" alt="2"></p><p><img src="/images/electron10/3.png" alt="3"></p><p>然后安装即可</p><h2 id="三、Feature"><a href="#三、Feature" class="headerlink" title="三、Feature"></a>三、Feature</h2><h3 id="1-当前electron包体过大，无法通过邮件发送"><a href="#1-当前electron包体过大，无法通过邮件发送" class="headerlink" title="1.当前electron包体过大，无法通过邮件发送"></a>1.当前electron包体过大，无法通过邮件发送</h3><p>后续想换个别的框架，例如tauri来缩小包体，通过邮件发送，避免国内github下载缓慢的问题</p><h3 id="2-目前应用图标不支持自定义"><a href="#2-目前应用图标不支持自定义" class="headerlink" title="2.目前应用图标不支持自定义"></a>2.目前应用图标不支持自定义</h3><p>主要是没钱买服务器或者图床，要是有老哥有免费的图床分享一下也是极好的</p><p>目前的图标是我随便找的=。=如有侵权，请联系我删除</p><h3 id="3-添加更多的自定义配置"><a href="#3-添加更多的自定义配置" class="headerlink" title="3.添加更多的自定义配置"></a>3.添加更多的自定义配置</h3><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p>无</p>]]></content:encoded>
      
      
      <category domain="http://blog.xingxiaowu.cn/categories/electron/">electron</category>
      
      
      <category domain="http://blog.xingxiaowu.cn/tags/electron/">electron</category>
      
      
      <comments>http://blog.xingxiaowu.cn/2022/02/21/%E6%97%A0%E6%98%9F%E7%9A%84electron%E4%B9%8B%E6%97%85%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94%20%E9%98%BF%E6%98%9F%E7%9A%84electron%E6%89%93%E5%8C%85%E9%A1%B5%E9%9D%A2/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
